## Nimについて考える

### 前提
- 石の山が${N}$個ある
- 山${i(1 \le i \le N )}$には、${A_i}$個の石が積まれている
- 2人のプレイヤーが交互に次の操作を行う
<br>
- 好きな石の山を1つ選び、選んだ山から1個以上の石を取る

### 負け
- 操作を行えなくなった方
- 石の山がすべてなくなった状態で手番が回った方

### 条件
- ${2 \le N \le 100000}$
- ${1 \le A_i \le 10^9}$

## 考え方

### 山が2個の場合
- 山にある石が同数ならば物真似戦略をとる
- 先手が1つ取ったら、異なる山から1つ取る⇒後手必勝

- 山にある石が同数でないなら、先手必勝
- 先手は1手目で同数にする。そこからは後手に合わせて物真似戦略。

### 山が3個以上の場合
- ${A_1 \oplus A_2 \oplus \dots \oplus A_N=0}$の時、後手必勝
- ${A_1 \oplus A_2 \oplus \dots \oplus A_N \neq 0}$の時、先手必勝。
<br>
- 例
- ${N=3,(A_1,A_2,A_3)=(1,2,3)}$の時
- ${1 \oplus 2 \oplus 3 = 0}$なので、後手必勝。

## 判定法を証明したい

### 前提
- 石の数をすべてXORした値をニム和と呼ぶ
1. ニム和が0である状態から一手操作して、ニム和を0にする方法はない（負け状態）
2. ニム和が0でない状態から一手操作して、ニム和を0にする方法はある（勝ち状態）

上記2つを証明できればいい

### 負け状態を具体例から証明する
- ${N=4, (A_1,A_2,A_3,A_4)=(4,5,6,7)}$
- 操作前のニム和は0になる
- ${4 \oplus 5 \oplus 6 \oplus 7 = 0}$
- これは以下の性質が成り立つことを意味する
<br>
- 4,5,6,7の中で2進数表記の1の位が1となっている個数が偶数個
- 4,5,6,7の中で2進数表記の2の位が1となっている個数が偶数個
- 4,5,6,7の中で2進数表記の4の位が1となっている個数が偶数個
- 1回の操作をすると、どれか1つの山の石の数が減少するので、2進数表記で見たとき、どれか1つの桁は奇数になる。
- 例えば7を6にすると、2進数表記の1の位が奇数になる。
<br>
- ${4 \rightarrow 100}$
- ${5 \rightarrow 101}$
- ${6 \rightarrow 110}$
- ${7 \rightarrow 111}$
<br>

- 一般の場合もこれは同じで、操作前のニム和が0の時、xorを考えると全ての位について、操作前の石の数が1となっているものの個数が偶数個になる
- しかし、1回の操作を行うと、どれか1つの山の個数が減少するため、操作後の石の数が1となっているものの個数が奇数個であるような位が、少なくとも1つは出てくる。よって、前提1は示された。

### 勝ち状態を具体例から証明する
- ${N=4, (A_1,A_2,A_3,A_4)=(4,6,8,9)}$
- 操作前のニム和は${4 \oplus 6 \oplus 8 \oplus 9 = 3}$
- 従ってニム和を0にするためには、2進数表記の1の桁と2の桁を反転させるような石の取り除き方をする必要がある
<br>

- ${4 \rightarrow 0100}$
- ${6 \rightarrow 0110}$
- ${8 \rightarrow 1000}$
- ${9 \rightarrow 1001}$
<br>

- 各山に対して、それを行うと、
- 山1の場合、${4\rightarrow 7}$
- 山2の場合、${6\rightarrow 5}$
- 山2の場合、${8\rightarrow 11}$
- 山2の場合、${9\rightarrow 10}$
- つまり、山2の操作に限り許される
<br>

- 一般の場合を証明する
- 操作前のニム和Xを2進法で表したとき、${2^{d_1},2^{d_2},\dots,2^{d_k}}$の位が1であったとする。
- この時、ニム和を0にするためには${2^{d_1},2^{d_2},\dots,2^{d_k}}$の位を反転させるような石の取り除き方をする必要がある
- ${2^{d_k}}$の位が0である山を選んだ場合、操作後の${2^{d_k}}$の位が1に変わるので、石の数が増える。
- そのため${2^{d_k}}$の位が1である山を選ぶ。そうすれば${2^{d_{k-1}}}$以下の桁を全て1にしても数は減る。
- ${X}$の${2^{d_k}}$が1であることからこのような山は必ず1つ以上存在するので、ニム和を0にする操作は可能。よって前提2は示された。
<br>

- つまり、xorが3なら11なので、${2^1}$の位が${1}$であるもの。5なら101なので、${2^2}$の位が${1}$であるものを選ぶ。
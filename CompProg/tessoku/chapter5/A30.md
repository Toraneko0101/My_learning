## フェルマーの小定理を証明する

### 0. 学習先
`https://qiita.com/drken/items/6b4031ccbb2cab7436f3`

### 1. mod
${13\div 4\equiv 16\pmod{17}}$
${4\times 16 = 64 \equiv 13\pmod{17}}$が成り立つため

modの補足をここに書く

### 2. フェルマーの小定理
${p}$を素数、${a}$を${p}$の倍数でない、任意の整数としたとき、
${a^{p-1}\equiv 1\pmod{p}}$
具体例(p=7)
${2^{7-1}=64\equiv 1\pmod{7}}$

### 3. 方針
掛け算の余りを考える
| |1|2|3|4|5|6|
|-|-|-|-|-|-|-|
|1|1|2|3|4|5|6|
|2|2|4|6|1|3|5|
|3|3|6|2|5|1|4|
|4|4|1|5|2|6|3|
|5|5|3|1|6|4|2|
|6|6|5|4|3|2|1|

・どの行を見ても、1~6の並び替えになっている
・この性質は${1*1}$から${(p-1)*(p-1)}$までの掛け算表でも成立するとのこと

・上記の性質より、${(3*1,3*2.3*3,3*4,3*5,3*6)}$と
${(1,2,3,4,5,6)}$とでは、${\pmod{7}}$において
並び変えると等しい。
・掛け算の場合、あまりはどのタイミングでとっても良いため
${(3*1)(3*2)(3*3)(3*4)(3*5)(3*6)\equiv 6!\pmod{7}}$
つまり、
${(6!)3^6 \equiv 6! \pmod{7}}$
法である${7}$と、${6!}$は互いに素なので、両辺を${6!}$で割ることができ、
${3^6 \equiv 1 \pmod{7}}$が導かれた。

## 4. 一般の場合で議論する

${p}$を任意の素数、${a}$を${p}$で割り切れない任意の整数とする。
この時、${a, 2a, 3a,\dots (p-1)a}$と、${1,2,3,\dots,p-1}$とは、${\pmod{p}}$において、並び替えを除いて等しい
よって、${\pmod{p}}$において、${(p-1)!a^{p-1}\equiv (p-1)!}$であるため、${a^{p-1}\equiv 1}$であるといえる。

## 5. 残り
${p}$を任意の素数、${a}$を${p}$で割り切れない任意の整数とする。
この時、${a, 2a, 3a,\dots (p-1)a}$と、${1,2,3,\dots,p-1}$とは、${\pmod{p}}$において、並び替えを除いて等しい
を証明したい

[方針]
${a, 2a, 3a,\dots (p-1)a}$が${\pmod{p}}$において互いに異なることを示せればいい

[証明]

${x,y}$を${1 \le x,\; y\le p-1,\; x\neq y}$を満たす整数とするとき、${xa}$と${ya}$とが${\pmod{p}}$において互いに異なることを示す。
***
仮に、${xa\equiv ya\pmod{p}}$となりうると仮定すると
${a(x-y)\equiv 0\pmod{p}}$が成り立ち、${a,p}$が互いに素であることから${a}$で割れ、${x-y\equiv 0\pmod p}$となる
条件より、${1 \le x,\; y\le p-1}$であるため${x=y}$となるが、これは${x\neq y}$と矛盾する。
よって、${xa}$と${ya}$とは${\pmod{p}}$において互いに異なる
***
${xa \not\equiv ya\pmod{p}}$より、
${a,2a,3a,\dots,(p-1)a}$を${p}$で割った余りは、どの2つをとっても互いに異なる。そのため${p-1}$までで考えたとき、1~p-1までの数があまりとして1度は登場することから、${a, 2a, 3a,\dots (p-1)a}$と、${1,2,3,\dots,p-1}$とは、${\pmod{p}}$において、並び替えを除いて等しいといえる。
***
したがって、${p}$を素数とし、${a}$を${p}$で割り切れない整数としたとき、${ax\equiv 1\pmod{p}}$を満たすような${x}$(ただし、${1 \le x \le p-1}$)は${\pmod{p}}$において一意に存在する。

## 6. 逆元を計算する
${ax\equiv 1\pmod{p}}$を満たすような${x}$を${\pmod{p}}$における、${a}$の逆元という

フェルマーの小定理である
${a^{p-1}\equiv 1\pmod{p}}$の式を変形すると
${a \times a^{p-2}\equiv 1\pmod{p}}$となる
これは、${a^{p-2}}$が${a}$の逆元であることを意味する
つまり、${a^{p-2}\pmod{p}}$を計算することで、${a}$の逆元は求まる

## 7. 繰り返し二乗法を使って、${a^{p-2}\pmod{p}}$を計算する
${a\times{13}^{101-2}\pmod{p}}$
```cpp
#include <iostream>
using namespace std;

long long modPow(long long a, long long b, long long p){
    if(b==0) return 1;
    if(b==1) return a % p;
    //端数用
    if(b % 2 == 1) return (a * modPow(a,b-1,p)) % p;
    long long t = modPow(a, b/2, p);
    return (t * t) % p; //a^8 = a^4 * a^4
}

int main(){
    long long a, b, p;
    cin >> a >> b >> p;
    cout << modPow(a,b-2,p) << endl;
    return 0;
}
```

## 8. ${a\div{b}\pmod{p}}$を考える
${a\div{b}\equiv a\times{b}^{-1}\pmod{p}}$
つまり、${1\div{b}\pmod{p}}$が求まれば、それを${a}$倍した値が、解になる。

ここで、${ax\equiv 1\pmod{p}}$を満たすような${x}$を${\pmod{p}}$における、${a}$の逆元といった事を思い出す
ここで、${x}$は${a}$を掛けると1になる数である

${1\div{b}\pmod{p}}$を考えると、${1\div{b}}$は${b}$を掛けると1になる数である。よって、${1\div{b}}$は、${\pmod{p}}$における${b}$の逆元

${b}$が${p}$で割り切れない整数であるとき、フェルマーの小定理${(b^{p-1}=b*b^{p-2}\equiv 1\pmod{p})}$より、${p}$が素数であり、${b}$の逆元(掛けると1になる数)は${b^{p-2}}$
よって、${1\div{b}\equiv b^{p-2}\pmod{p}}$

競プロ的に言うと、最終的に素数である${p}$で割った時の余りを求める問題であるとき、途中で割り算が出てきても、代わりに${b^{p-2}}$を掛けておけば、解は一意に求まる。(${\div{b}}$と${\times b^{p-2}}$は等価。)
